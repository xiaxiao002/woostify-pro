"use strict";var woostifyPrevSiblings=function(e){var t=[],o=e;if(o&&o.previousElementSibling)for(;o=o.previousElementSibling;)t.push(o);return t},woostifyNextSiblings=function(e){var t=[],o=e;if(o&&o.nextElementSibling)for(;o=o.nextElementSibling;)t.push(o);return t},woostifySiblings=function(e){var t=woostifyPrevSiblings(e)||[],e=woostifyNextSiblings(e)||[];return t.concat(e)},woostifyButtonShowPopup=function(){var e=document.querySelectorAll(".menu-item-mega_menu.menu-item-depth-0");e.length&&e.forEach(function(e){var t=e.getAttribute("id"),e=e.querySelector(".edit-menu-item-title"),e=!!e&&e.closest("p.description");e&&t&&(t=t.replace("menu-item-",""),e.insertAdjacentHTML("afterend",'<div class="description description-wide"><span class="woostify-mega-menu-options-button button" data-id="'+t+'" data-depth="0">'+woostify_admin_mega_menu.button_label+"</span></div>"))})},woostifyIconPicker=function(){var e,n,t=document.querySelector(".woostify-icon-picker");t&&(t.querySelector(".woostify-icon-picker-inner"),e=t.querySelectorAll("span"),n=t.querySelector(".woostify-icon-picker-value"),e.length&&e.forEach(function(o){o.onclick=function(){var e=woostifySiblings(o),t=o.getAttribute("data-icon");o.classList.contains("selected")?(o.classList.remove("selected"),n.value=""):(o.classList.add("selected"),n.value=t),e&&e.forEach(function(e){e.classList.remove("selected")})}}))},woostifySaveMenuOptions=function(){var n=document.querySelector(".woostify-mega-menu-options-popup"),e=n.getAttribute("data-id"),i=document.querySelector("#menu-item-"+e+" .woostify-mega-menu-options-button").getAttribute("data-id");n.querySelector(".save-options").onclick=function(){var e=this,t=n.querySelectorAll("[name*=woostify_mega_menu_item_]"),o={},t=(e.classList.add("loading"),e.setAttribute("disabled","disabled"),t.length&&t.forEach(function(e){o[e.name]=e.value}),new Request(ajaxurl,{method:"POST",body:"action=woostify_save_menu_options&security_nonce="+woostify_admin_mega_menu.ajax_nonce+"&menu_item_id="+i+"&options="+JSON.stringify(o),credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})}));fetch(t).then(function(e){200!==e.status&&console.log("Status Code: "+e.status)}).catch(function(e){console.log(e)}).finally(function(){e.classList.remove("loading"),e.removeAttribute("disabled")})}},woostifyEditMegaMenu=function(){var e=document.querySelectorAll(".woostify-mega-menu-options-button");e.length&&e.forEach(function(e){function n(){document.documentElement.classList.remove("has-mega-menu-open")}var i=document.querySelector(".woostify-mega-menu-options-popup"),s=i.querySelector(".woostify-mega-menu-popup-inner"),u=i.querySelector(".woostify-mega-menu-popup-content"),a=i.querySelector(".woostify-mega-menu-editing-label"),c=i.querySelector(".woostify-mega-menu-popup-button-close"),r=e.getAttribute("data-id"),l=e.getAttribute("data-depth");e.onclick=function(){var e,t,o;0<l||(document.documentElement.classList.add("has-mega-menu-open"),t=document.getElementById("menu-item-"+r),o=i.getAttribute("data-id"),e=t?t.querySelector(".menu-item-title").innerHTML:"",t=t?t.querySelector(".item-type").innerHTML:"",o!==r&&(a.innerHTML=a.getAttribute("data-label")+" "+t+": "+e,u.innerHTML="",s.classList.add("loading"),o=new Request(ajaxurl,{method:"POST",body:"action=woostify_render_popup&security_nonce="+woostify_admin_mega_menu.ajax_nonce+"&menu_item_id="+r+"&depth="+l,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})}),fetch(o).then(function(e){200===e.status?e.json().then(function(e){e.success&&(u.innerHTML=e.data,woostifyIconPicker())}):console.log("Status Code: "+e.status)}).catch(function(e){console.log(e)}).finally(function(){i.setAttribute("data-id",r),s.classList.remove("loading"),woostifySaveMenuOptions(),i.onclick=function(e){e.target.closest(".woostify-mega-menu-popup-inner")||n()},c.onclick=function(){n()},document.body.addEventListener("keyup",function(e){27===e.keyCode&&n()})})))}})};document.addEventListener("DOMContentLoaded",function(){woostifyButtonShowPopup(),woostifyEditMegaMenu()});